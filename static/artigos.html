<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö Base de Conhecimento - Artigos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            display: block;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
            font-size: 0.9em;
        }

        .search-box {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .search-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .filter-btn:hover {
            background: #667eea;
            color: white;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
        }

        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .article-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .article-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .article-title {
            color: #667eea;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .article-preview {
            color: #666;
            font-size: 0.95em;
            line-height: 1.6;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .article-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85em;
            color: #999;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }

        .article-chunks {
            background: #f0f0f0;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 500;
        }

        .article-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }

        .article-link:hover {
            text-decoration: underline;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 1.2em;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 10px;
            color: #666;
        }

        .no-results-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #f8f9ff;
        }

        /* Pagina√ß√£o */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .pagination-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .pagination-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .pagination-info {
            font-size: 1.1em;
            color: #333;
            font-weight: 600;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            color: #667eea;
            font-size: 1.5em;
            font-weight: bold;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: #999;
            line-height: 1;
        }

        .close-btn:hover {
            color: #667eea;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .articles-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Base de Conhecimento</h1>
            <p>Explore e busque artigos da Wikipedia na base vetorial</p>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="window.location.href='/'">üè† Voltar</button>
                <button class="btn btn-secondary" onclick="carregarArtigos()">üîÑ Atualizar</button>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <span class="stat-value" id="totalArtigos">-</span>
                <span class="stat-label">Artigos</span>
            </div>
            <div class="stat-card">
                <span class="stat-value" id="totalChunks">-</span>
                <span class="stat-label">Chunks</span>
            </div>
            <div class="stat-card">
                <span class="stat-value" id="artigosFiltrados">-</span>
                <span class="stat-label">Exibindo</span>
            </div>
        </div>

        <div class="search-box">
            <input 
                type="text" 
                class="search-input" 
                id="searchInput" 
                placeholder="üîç Buscar artigos por palavra-chave..." 
                oninput="filtrarArtigos()"
            >
            <div class="filters">
                <button class="filter-btn active" onclick="ordenar('alfabetica', event)">A-Z</button>
                <button class="filter-btn" onclick="ordenar('chunks', event)">Mais Chunks</button>
                <button class="filter-btn" onclick="ordenar('recentes', event)">Mais Recentes</button>
            </div>
        </div>

        <div id="loadingContainer" class="loading">
            <div>‚è≥ Carregando artigos...</div>
        </div>

        <div id="articlesContainer" class="articles-grid" style="display: none;"></div>

        <div id="pagination" class="pagination" style="display: none;">
            <button class="pagination-btn" id="prevBtn" onclick="irParaPagina(paginaAtual - 1)">
                ‚Üê Anterior
            </button>
            <div class="pagination-info">
                <span id="paginacaoTexto">P√°gina 1 de 1</span>
            </div>
            <button class="pagination-btn" id="nextBtn" onclick="irParaPagina(paginaAtual + 1)">
                Pr√≥xima ‚Üí
            </button>
        </div>

        <div id="noResults" class="no-results" style="display: none;">
            <div class="no-results-icon">üîç</div>
            <h2>Nenhum artigo encontrado</h2>
            <p>Tente buscar com outras palavras-chave</p>
        </div>
    </div>

    <!-- Modal para detalhes do artigo -->
    <div id="articleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle"></h2>
                <button class="close-btn" onclick="fecharModal()">&times;</button>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        // Configura√ß√£o da API
        const API_BASE = window.location.origin;
        
        let todosArtigos = [];
        let artigosFiltrados = [];
        let ordenacaoAtual = 'alfabetica';
        
        // Configura√ß√£o de pagina√ß√£o
        const ARTIGOS_POR_PAGINA = 50;
        let paginaAtual = 1;
        let totalPaginas = 1;

        // N√ÉO carregar artigos automaticamente - apenas ao buscar/filtrar
        window.addEventListener('DOMContentLoaded', () => {
            // Carregar metadados mas n√£o exibir artigos
            carregarMetadados();
        });

        async function carregarMetadados() {
            const loading = document.getElementById('loadingContainer');
            
            loading.style.display = 'block';
            loading.innerHTML = '<div>‚è≥ Carregando base de conhecimento...</div>';

            try {
                const response = await fetch(`${API_BASE}/artigos`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const data = await response.json();
                
                todosArtigos = data.artigos || [];
                artigosFiltrados = []; // N√£o filtrar nada inicialmente
                
                document.getElementById('totalArtigos').textContent = data.total || 0;
                document.getElementById('totalChunks').textContent = data.total_chunks || 0;
                document.getElementById('artigosFiltrados').textContent = 0;
                
                loading.style.display = 'none';
                document.getElementById('articlesContainer').innerHTML = '<div style="text-align: center; padding: 40px; background: white; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"><p style="font-size: 1.3em; color: #667eea; font-weight: 600;">üîç Use a busca acima para encontrar artigos</p><p style="color: #999; margin-top: 10px;">Digite palavras-chave para filtrar os artigos da base</p></div>';
                document.getElementById('articlesContainer').style.display = 'block';
                
            } catch (error) {
                console.error('Erro ao carregar metadados:', error);
                loading.innerHTML = '<div style="color: #ff4444;">‚ùå Erro ao carregar base de conhecimento</div>';
            }
        }

        async function carregarArtigos() {
            const loading = document.getElementById('loadingContainer');
            const container = document.getElementById('articlesContainer');
            const noResults = document.getElementById('noResults');
            
            loading.style.display = 'block';
            container.style.display = 'none';
            noResults.style.display = 'none';

            try {
                const response = await fetch(`${API_BASE}/artigos`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const data = await response.json();
                
                todosArtigos = data.artigos || [];
                artigosFiltrados = [...todosArtigos];
                
                document.getElementById('totalArtigos').textContent = data.total || 0;
                document.getElementById('totalChunks').textContent = data.total_chunks || 0;
                
                ordenar(ordenacaoAtual);
                renderizarArtigos();
                
            } catch (error) {
                console.error('Erro ao carregar artigos:', error);
                loading.innerHTML = '<div style="color: #ff4444;">‚ùå Erro ao carregar artigos</div>';
            }
        }

        function filtrarArtigos() {
            const busca = document.getElementById('searchInput').value.toLowerCase();
            
            if (!busca.trim()) {
                // Se busca vazia, n√£o mostrar artigos
                artigosFiltrados = [];
                document.getElementById('articlesContainer').innerHTML = '<div style="text-align: center; padding: 40px; background: white; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"><p style="font-size: 1.3em; color: #667eea; font-weight: 600;">üîç Use a busca acima para encontrar artigos</p><p style="color: #999; margin-top: 10px;">Digite palavras-chave para filtrar os artigos da base</p></div>';
                document.getElementById('articlesContainer').style.display = 'block';
                document.getElementById('artigosFiltrados').textContent = 0;
                document.getElementById('pagination').style.display = 'none';
                return;
            } else {
                artigosFiltrados = todosArtigos.filter(artigo => {
                    return artigo.title.toLowerCase().includes(busca) ||
                           artigo.preview.toLowerCase().includes(busca);
                });
            }
            
            paginaAtual = 1; // Resetar para primeira p√°gina ao filtrar
            renderizarArtigos();
        }

        function irParaPagina(pagina) {
            if (pagina < 1 || pagina > totalPaginas) return;
            paginaAtual = pagina;
            renderizarArtigos();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function atualizarPaginacao() {
            totalPaginas = Math.ceil(artigosFiltrados.length / ARTIGOS_POR_PAGINA);
            
            const paginacao = document.getElementById('pagination');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const paginacaoTexto = document.getElementById('paginacaoTexto');
            
            if (totalPaginas <= 1) {
                paginacao.style.display = 'none';
            } else {
                paginacao.style.display = 'flex';
                prevBtn.disabled = paginaAtual === 1;
                nextBtn.disabled = paginaAtual === totalPaginas;
                paginacaoTexto.textContent = `P√°gina ${paginaAtual} de ${totalPaginas}`;
            }
        }

        function ordenar(tipo, event) {
            ordenacaoAtual = tipo;
            
            // Atualizar bot√µes ativos (se chamado via clique)
            if (event) {
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
            }
            
            switch(tipo) {
                case 'alfabetica':
                    artigosFiltrados.sort((a, b) => a.title.localeCompare(b.title, 'pt-BR'));
                    break;
                case 'chunks':
                    artigosFiltrados.sort((a, b) => b.chunks - a.chunks);
                    break;
                case 'recentes':
                    artigosFiltrados.sort((a, b) => {
                        const dateA = new Date(a.timestamp || 0);
                        const dateB = new Date(b.timestamp || 0);
                        return dateB - dateA;
                    });
                    break;
            }
            
            renderizarArtigos();
        }

        function renderizarArtigos() {
            const loading = document.getElementById('loadingContainer');
            const container = document.getElementById('articlesContainer');
            const noResults = document.getElementById('noResults');
            
            loading.style.display = 'none';
            
            document.getElementById('artigosFiltrados').textContent = artigosFiltrados.length;
            
            if (artigosFiltrados.length === 0) {
                container.style.display = 'none';
                noResults.style.display = 'block';
                document.getElementById('pagination').style.display = 'none';
                return;
            }
            
            container.style.display = 'grid';
            noResults.style.display = 'none';
            
            // Calcular artigos da p√°gina atual
            const inicio = (paginaAtual - 1) * ARTIGOS_POR_PAGINA;
            const fim = inicio + ARTIGOS_POR_PAGINA;
            const artigosPagina = artigosFiltrados.slice(inicio, fim);
            
            // Atualizar pagina√ß√£o
            atualizarPaginacao();
            
            container.innerHTML = artigosPagina.map(artigo => `
                <div class="article-card" onclick="abrirArtigo('${artigo.url}', '${escapeHtml(artigo.title)}')">
                    <div class="article-title">
                        üìÑ ${escapeHtml(artigo.title)}
                    </div>
                    <div class="article-preview">
                        ${escapeHtml(artigo.preview)}...
                    </div>
                    <div class="article-meta">
                        <span class="article-chunks">${artigo.chunks} chunks</span>
                        ${artigo.url ? `<a class="article-link" href="${artigo.url}" target="_blank" onclick="event.stopPropagation()">üîó Wikipedia</a>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function abrirArtigo(url, titulo) {
            if (url) {
                window.open(url, '_blank');
            }
        }

        function fecharModal() {
            document.getElementById('articleModal').classList.remove('active');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Fechar modal ao clicar fora
        document.getElementById('articleModal').addEventListener('click', (e) => {
            if (e.target.id === 'articleModal') {
                fecharModal();
            }
        });
    </script>
</body>
</html>
